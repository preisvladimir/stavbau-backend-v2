create table companies (datum_aktualizace_ares date, datum_vzniku date, kod_kraje varchar(4), kod_statu varchar(2), standardizace_adresy boolean, typ_cislo_domovni varchar(4), cz_nace_prevazujici varchar(6), ares_last_sync_at timestamp(6) with time zone, created_at timestamp(6) with time zone, financni_urad_code varchar(8), ico varchar(8) not null unique, kategorie_poctu_pracovniku varchar(8), kod_okresu varchar(8), pravni_forma_code varchar(8), updated_at timestamp(6) with time zone, kod_casti_obce varchar(12), kod_obce varchar(12), cislo_domovni varchar(16), created_by uuid, id uuid not null, institucionalni_sektor2010 varchar(16), kod_adresniho_mista varchar(16), kod_ulice varchar(16), okres_nuts_lau varchar(16), psc varchar(16), updated_by uuid, zakladni_uzemni_jednotka varchar(16), nazev_kraje varchar(64), nazev_okresu varchar(64), nazev_statu varchar(64), nazev_casti_obce varchar(128), nazev_obce varchar(128), nazev_ulice varchar(128), textova_adresa varchar(512), obchodni_jmeno varchar(255), radek_adresy1 varchar(255), radek_adresy2 varchar(255), ares_raw jsonb, primary key (id));
create table company_nace (nace_code varchar(6) not null, company_id uuid not null, primary key (nace_code, company_id));
create table file_links (file_id uuid not null, target_id uuid not null, target_type varchar(255) not null check (target_type in ('COMPANY','PROJECT','INVOICE')), primary key (file_id, target_id, target_type));
create table file_tag_join (file_id uuid not null, tag_id uuid not null, primary key (file_id, tag_id));
create table file_tags (company_id uuid not null, id uuid not null, name varchar(64) not null, primary key (id), constraint ux_file_tags_company_name unique (company_id, name));
create table invoice_lines (line_total numeric(18,2) not null, quantity numeric(18,3) not null, unit_price numeric(18,2) not null, vat_rate numeric(5,2) not null, id uuid not null, invoice_id uuid not null, unit varchar(32) not null, item_name varchar(256) not null, primary key (id));
create table invoices (currency varchar(3) not null, due_date date not null, issue_date date not null, subtotal numeric(18,2) not null, tax_date date, total numeric(18,2) not null, vat_total numeric(18,2) not null, company_id uuid not null, id uuid not null, project_id uuid, status varchar(16) not null check (status in ('DRAFT','ISSUED','PAID','CANCELLED')), customer_json jsonb not null, number varchar(255), supplier_json jsonb not null, vat_mode varchar(255) not null check (vat_mode in ('NONE','STANDARD')), notes oid, primary key (id));
create table number_series (counter_value integer not null, counter_year integer not null, is_default boolean not null, version integer not null, company_id uuid not null, id uuid not null, key varchar(32) not null, pattern varchar(64) not null, primary key (id), constraint ux_number_series_company_year_key unique (company_id, counter_year, key));
create table stored_files (created_at timestamp(6) with time zone not null, size_bytes bigint not null, company_id uuid not null, id uuid not null, uploader_id uuid not null, sha256 varchar(64) not null, storage_key varchar(512) not null, mime_type varchar(255) not null, original_name varchar(255) not null, primary key (id));
create table users (token_version integer not null, created_at timestamp(6) with time zone, updated_at timestamp(6) with time zone, locale varchar(10), company_id uuid not null, created_by uuid, id uuid not null, refresh_token_id uuid, updated_by uuid, email varchar(320) not null unique, password_hash varchar(255) not null, primary key (id));
create index ix_company_nuts on companies (okres_nuts_lau);
alter table if exists company_nace add constraint FK4ujxyrmd05of02ih46ql46wrw foreign key (company_id) references companies;
